#!/usr/bin/env ruby

require "rubygems"
require "eventmachine"
require "logstash/agent"

case ARGV[0]
when "client"
  config = {
    "input" => [
      "/var/log/messages",
      "/var/log/apache2/access.log",
    ],
    "output" => [
      "amqp://localhost/topic/testing",
      "websocket:///",
      "mongodb://localhost/testdb",
    ],
  }
when "server"
  config = {
    "input" => [
      "amqp://localhost/topic/testing",
    ],
    "filter" => [
      "grok",
    ],
    "output" => [
      "stdout:///",
      "amqp://localhost/topic/parsed",
    ],
  }
when "standalone"
  config = {
    "input" => [
      "/var/log/messages",
      "/var/log/apache2/access.log",
    ],
    "filter" => [
      "grok",
    ],
    "output" => [
      "mongodb://localhost/testdb",
    ],
  }
else
  puts "Don't know what you want me to do."
  exit 1
end

agent = LogStash::Agent.new(config)
agent.run
