#summary Details on installing and configuring the logstash server
#labels Phase-Deploy

= Introduction =

This page details how to install and configure the LogStash server. We assume you are on on a RedHat-based distro (RHEL, CentOS, Fedora, etc). Step-by-step instructions (and packages) for other operating systems would be a welcome contribution.

= Installation =

=== Message Broker ====

LogStash components communicate through the AMQP protocol to a message broker. There are different options available out there, but we recommend [http://www.rabbitmq.com RabbitMQ]. It's very easy to install (pre-packaged in many distributions), requires no post-install configuration, and is fast. It also supports a "cluster" mode across multiple hosts. See the [http://www.rabbitmq.com/documentation.html RabbitMQ documentation] for installation instructions and configuration options. The rest of this document will assume you use the default settings.

=== Grok Ruby extensions ===

You will need the [http://code.google.com/p/semicomplete grok-ruby RPM] (which depends on the `grok` RPM for `libgrok.so`, available from the same location). There is nothing to configure here -- to test the installation:

{{{
$ irb
0 fetepx3(~) % irb
irb(main):001:0> require "Grok"
=> true
irb(main):002:0>
}}}

=== Ruby Gems ===

If you do not already have rubygems installed (check by running `which gem`), you can install it by running `apt-get install rubygems`. Gems are a third-party package format that many Ruby modules are distributed in.

Install the following gems (`gem install foo`):

  * amqp
  * eventmachine
  * ferret
  * file-tail
  * merb (only if you are using the web interface)
  * mqrpc
  * uuid

=== LogStash RPMs ===

Download the RPMs from this site (see the Downloads tab). You need `logstash-libs` and `logstash-server` for a basic installation. We recommend `logstash-web` so you can have a basic web interface for querying results.

Installing the `logstash-server` RPM will add a `logstash` user and group (the indexer and parser will run as this user) and create /var/logstash (where the indexes will go). A service named `logstash` will be created, but disabled by default (run `chkconfig logstash on` to enable it to start at boot).

The libraries and server daemons will be installed into `/opt/logstash`. The default config file is `/opt/logstash/etc/logstashd.yaml` (covered in more detail below), and the default log file is `/var/logstash/logstashd.log`.

= Configuration =

The default config file is located at `/opt/logstash/etc/logstashd.yaml`. There are a few classes of things you may need to change.

=== Index Directory ===

By default, `logstash_dir` is set to `/var/logstash`. One sub-directory per log type will be created in this directory, and all of the log indexes will be stored here. If you use a different directory, make sure that user `logstash` can write there.

=== AMQP Settings ===

There are some different settings for talking AMQP to the message broker:

 * `mqhost`: hostname of the server (defaults to "localhost")
 * `mqport`: port of the server (defaults to 5672)
 * `mquser`: AMQP username
 * `mqpass`: AMQP password
 * `mqvhost`: AMQP virtual host

If you are using RabbitMQ out of the box, all of the defaults are fine (except maybe `mqhost`).

=== Log Types ===

By default, `logstashd` is configured to understand how to index Linux syslog lines. One of the coolest parts about LogStash is adding custom patterns to more specifically interpret some syslog events in your environment, and adding custom log types (which may also involve custom patterns). For more discussion about that, please see CustomLogPatterns and CustomLogTypes.

=== Scaling ===

You may want to run more than one parser to take advantage of multi-core machine, or you may eventually want to scale to more than one indexserver on different disks/machines. Please read the [Scaling] page to help make these decisions. Once you've made up your mind, you can edit `/etc/sysconfig/logstash` to configure how many parsers should run here (and if you want an indexer at all).

The default of 1 parser and 1 indexserver is good for most people. A majority of people will only ever want to tweak the number of parsers.

= Starting the server =

Since the `logstash-server` RPM includes an init script, you just need to run `service logstash start` to start the daemon. If you want to automatically start it at boot, run `chkconfig logstash on`.

To test if the server is healthy, monitor the `/var/logstash/logstashd.log` log file. There should be no warning lines; only info lines.

= Starting the web service =

  * cd /opt/logstash/web
  * merb -N -p 4001 -L /tmp/logstash-merb.log -P /tmp/logstash-merb.pid

= What's next? =

Now you need to [AgentConfiguration configure some logstash agents], then try [Searching].